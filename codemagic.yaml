workflows:
  ios-workflow:                # workflow ID
    name: iOS Workflow       # workflow name displayed in Codemagic UI
    max_build_duration: 120       # build duration in minutes (min 1, max 120)
    instance_type: mac_mini_m1
    environment:
      groups:
        - ios_signing

    scripts:
      - name: Set up keychain to be used for code signing using Codemagic cLI "keychain' command
        script: keychain initialize

      - name: Fetch signing files
        script: app-store-connect fetch-signing-files "io.iosacademy.i0S-Academy' \
            --type IOS_APP STORE \ 
            --Create

      - name: Set up signing rertificate
        script: keychain add-certificates

      - name: Set up code signing settings on Xcode project
        script: xcode-project use-profiles 

      - name: Build App
        script: xcode-project build-ipa --workspace "project.xcworkspace" --scheme "firstBuild"
    publishing:
      app_store_connect:
        api_key: $APP_STORE_CONNECT_PRIVATE_KEY
        key_id: $APP_STORE_CONNECT_KEY_IDENTIFIER
        issuer_id: $APP_STORE_CONNECT_ISSUER_ID
